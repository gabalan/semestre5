(*exercice 7.2*)

(*1*)
type huffman_tree = Single of char | Double of huffman_tree * huffman_tree
let rec insert_sorted c l=match l with
  |[]->[(c,1)]
  |(x,m)::r->if x=c then (x,m+1)::r
             else if c<x then (c,1)::l
             else (x,m)::insert_sorted c r;;
  insert_sorted 0 [(1,3);(2,4);(3,1)];;
  (*2*)
    let inf (cx,mx) (cy,my)= if mx<my then -1 else if mx=my then 0 else 1;;
   let   charlist_to_freqlist l=
     let rec aux l acc=
       match l with
       |[]->List.sort inf acc
       |letter::tail-> aux tail (insert_sorted letter acc) in aux l [];;

   let chaine=['s';'w';'i';'m';'m';'i';'n';'g';' ';'i';'n';' ';'t';'h';'e';' ';'m';'i';'s';'s';'i';'s';'s';'i';'p';'i'];;
   let inf2 x y =if x<y then -1 else if x=y then 0 else 1;;

     (*3*)

    let  charlist_to_treelist l=
      let t=charlist_to_freqlist l in
      let rec aux t acc=
               match t with
               |[]->List.rev acc
               |(letter,m)::r->aux r ((Single letter ,m)::acc) in aux t [];;

    (*4*)
      
    let rec treelist_to_hufftree l=
      match l with
      |[]->failwith"liste vide"
      |(c,m)::[]->c
      |( t1,m1)::(t2,m2)::tail->treelist_to_hufftree (List.sort inf  ((Double(t1,t2),m1+m2)::tail));;

    let  treelist=charlist_to_treelist chaine;;
    (*5*)
    let string_to_hufftree s=
      let rec aux i n s acc=
        if i=n then treelist_to_hufftree (charlist_to_treelist acc)
        else aux (i+1) n s (s.[i]::acc)
                 in aux 0 (String.length s) s [];;
